{% extends "base.html" %}
{% block content %}

<div class="card">
  <h2>Orders</h2>
  <p class="muted">Track your placed orders and transport quotes.</p>

  {% if orders %}
    <div class="orders">
      {% for pack in orders %}
        <div class="order-card">
          <div class="row">
            <div>
              <div class="strong">Order {{ pack["order_id"] }}</div>
              <div class="muted small">
                {{ pack["origin"] }} → {{ pack["dest"] }}
                {% if pack.get("eta_hours") %} · ETA {{ pack["eta_hours"] }} hrs{% endif %}
                · {{ pack["created_at"] }}
              </div>
            </div>
            <div class="status">{{ pack["status"] }}</div>
          </div>

          <div class="summary">
            <div class="sumrow"><span>Items total</span><b>{{ money(pack["items_total"]) }}</b></div>
            <div class="sumrow"><span>Transport</span><b>{{ money(pack["transport"]) }}</b></div>
            <div class="sumrow"><span>Grand total</span><b>{{ money(pack["grand_total"]) }}</b></div>
          </div>

          <div class="spacer"></div>

          <div class="muted small strong">Items</div>
          <div class="items">
            {% for it in pack["items"] %}
              <div class="itemrow">
                <span>{{ it["name"] }} × {{ it["qty"] }}</span>
                <b>{{ money(it["subtotal"]) }}</b>
              </div>
            {% endfor %}
          </div>

          {% if pack.get("quotes") %}
            <div class="spacer"></div>
            <div class="muted small strong">Transport Quotes</div>

            <div class="quotes">
              {% for q in pack["quotes"] %}
                <div class="quote-row">
                  <div>
                    <div class="strong">{{ q["transporter_phone"] }}</div>
                    <div class="muted small">Quoted: {{ money(q["amount"]) }} · {{ q["created_at"] }}</div>
                  </div>

                  {% if pack["status"] in ["AWAITING_QUOTES", "QUOTED"] %}
                    <form method="post" action="/quote/accept" class="inline">
                      <input type="hidden" name="order_id" value="{{ pack['order_id'] }}">
                      <input type="hidden" name="quote_id" value="{{ q['id'] }}">
                      <button class="btn btn-primary" type="submit">Accept</button>
                    </form>

                    <form method="post" action="/quote/decline" class="inline">
                      <input type="hidden" name="order_id" value="{{ pack['order_id'] }}">
                      <input type="hidden" name="quote_id" value="{{ q['id'] }}">
                      <button class="btn btn-dark" type="submit">Decline</button>
                    </form>
                  {% else %}
                    <div class="muted small">Locked ({{ pack["status"] }})</div>
                  {% endif %}
                </div>
              {% endfor %}
            </div>
          {% endif %}

        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="muted">No orders yet.</p>
  {% endif %}
</div>

{% endblock %}
